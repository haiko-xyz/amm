# Modify position

## Case 1 (MPALU): Add liquidity at previously uninitialised limits

1. Initial market config checks: [36000]
2. Read state: [61000]
3. Input checks: [0]
4. Update liquidity: [3881330][T]
   1. Read state: [25000]
   2. Update lower limit: [1781120][T]
      1. Update limit: [25000]
      2. Check overflow: [0]
      3. Update bitmap: [1731120]
      4. Calc and set fee factors: [0]
   3. Update upper limit: [1133200][T]
      1. Update limit: [25000]
      2. Check overflow: [0]
      3. Update bitmap: [1083200]
      4. Calc and set fee factors: [0]
   4. Initialise position: [41450]
   5. Calc fees: [0]
   6. Update position: [25000]
   7. Calculate token amounts: [875560]
5. Update fees: [0]
6. Update reserves: [40000]
7. Transfer tokens: [1065940]
8. Emit event: [1000]

Total: [5085270]

## Case 2 (MPALI): Add liquidity at previously initialised limits

1. Initial market config checks: [36000]
2. Read state: [61000]
3. Input checks: [0]
4. Update liquidity: [1067010][T]
   1. Read state: [25000]
   2. Update lower limit: [50000][T]
      1. Update limit: [25000]
      2. Check overflow: [0]
      3. Update bitmap: [0]
      4. Calc and set fee factors: [0]
   3. Update upper limit: [50000][T]
      1. Update limit: [25000]
      2. Check overflow: [0]
      3. Update bitmap: [1229520]
      4. Calc and set fee factors: [0]
   4. Initialise position: [41450]
   5. Calc fees: [0]
   6. Update position: [25000]
   7. Calculate token amounts: [875560]
5. Update fees: [0]
6. Update reserves: [40000]
7. Transfer tokens: [1065940]
8. Emit event: [1000]

Total: [2270950]

## Case 3 (MPALIU): Add liquidity at initialised lower, but previously uninitialised upper limit

1. Initial market config checks: [36000]
2. Read state: [61000]
3. Input checks: [0]
4. Update liquidity: [2744970][T]
   1. Read state: [25000]
   2. Update lower limit: [644760][T]
      1. Update limit: [25000]
      2. Check overflow: [0]
      3. Update bitmap: [594760]
      4. Calc and set fee factors: [0]
   3. Update upper limit: [1133200][T]
      1. Update limit: [25000]
      2. Check overflow: [0]
      3. Update bitmap: [1083200]
      4. Calc and set fee factors: [0]
   4. Initialise position: [41450]
   5. Calc fees: [0]
   6. Update position: [25000]
   7. Calculate token amounts: [875560]
5. Update fees: [0]
6. Update reserves: [40000]
7. Transfer tokens: [1065940]
8. Emit event: [1000]

Total: [3948910]

## Case 4 (MPCF): Collect fees from position (position is only one at limits)

1. Initial market config checks: [36000]
2. Read state: [61000]
3. Input checks: [0]
4. Update liquidity: [191450][T]
   1. Read state: [25000]
   2. Update lower limit: [50000][T]
      1. Update limit: [25000]
      2. Check overflow: [0]
      3. Update bitmap: [0]
      4. Calc and set fee factors: [0]
   3. Update upper limit: [50000][T]
      1. Update limit: [25000]
      2. Check overflow: [0]
      3. Update bitmap: [0]
      4. Calc and set fee factors: [0]
   4. Initialise position: [41450]
   5. Calc fees: [0]
   6. Update position: [25000]
   7. Calculate token amounts: [0]
5. Update fees: [20000]
6. Update reserves: [20000]
7. Transfer tokens: [402390]
8. Emit event: [1000]

Total: [731840]

## Case 5 (MPRL01): Remove liquidity with no accumulated fees (position is only one at limits)

1. Initial market config checks: [36000]
2. Read state: [61000]
3. Input checks: [0]
4. Update liquidity: [1042010][T]
   1. Read state: [25000]
   2. Update lower limit: [50000][T]
      1. Update limit: [25000]
      2. Check overflow: [0]
      3. Update bitmap: [0]
      4. Calc and set fee factors: [0]
   3. Update upper limit: [50000][T]
      1. Update limit: [25000]
      2. Check overflow: [0]
      3. Update bitmap: [0]
      4. Calc and set fee factors: [0]
   4. Initialise position: [41450]
   5. Calc fees: [0]
   6. Update position: [25000]
   7. Calculate token amounts: [850560]
5. Update fees: [0]
6. Update reserves: [20000]
7. Transfer tokens: [402390]
8. Emit event: [1000]

Total: [1530000]

## Case 6 (MPRLFM): Remove liquidity with accumulated fees (position is only one at limits)

1. Initial market config checks: [36000]
2. Read state: [61000]
3. Input checks: [0]
4. Update liquidity: [3846330][T]
   1. Read state: [25000]
   2. Update lower limit: [751080][T]
      1. Update limit: [25000]
      2. Check overflow: [0]
      3. Update bitmap: [701080]
      4. Calc and set fee factors: [0]
   3. Update upper limit: [2153240][T]
      1. Update limit: [25000]
      2. Check overflow: [0]
      3. Update bitmap: [2103240]
      4. Calc and set fee factors: [0]
   4. Initialise position: [41450]
   5. Calc fees: [0]
   6. Update position: [25000]
   7. Calculate token amounts: [850560]
5. Update fees: [0]
6. Update reserves: [20000]
7. Transfer tokens: [402390]
8. Emit event: [1000]

Total: [4366720]

## Case 7 (MPRL01): Remove liquidity with no accumulated fees (other positions exist at limits)

1. Initial market config checks: [36000]
2. Read state: [61000]
3. Input checks: [0]
4. Update liquidity: [1042010][T]
   1. Read state: [25000]
   2. Update lower limit: [50000][T]
      1. Update limit: [25000]
      2. Check overflow: [0]
      3. Update bitmap: [0]
      4. Calc and set fee factors: [0]
   3. Update upper limit: [50000][T]
      1. Update limit: [25000]
      2. Check overflow: [0]
      3. Update bitmap: [0]
      4. Calc and set fee factors: [0]
   4. Initialise position: [41450]
   5. Calc fees: [0]
   6. Update position: [25000]
   7. Calculate token amounts: [850560]
5. Update fees: [0]
6. Update reserves: [20000]
7. Transfer tokens: [402390]
8. Emit event: [1000]

Total: [1562400]

## Case 8 (MPRLFM): Remove liquidity with accumulated fees (other positions exist at limits)

1. Initial market config checks: [36000]
2. Read state: [61000]
3. Input checks: [0]
4. Update liquidity: [1067010][T]
   1. Read state: [25000]
   2. Update lower limit: [50000][T]
      1. Update limit: [25000]
      2. Check overflow: [0]
      3. Update bitmap: [0]
      4. Calc and set fee factors: [0]
   3. Update upper limit: [50000][T]
      1. Update limit: [25000]
      2. Check overflow: [0]
      3. Update bitmap: [0]
      4. Calc and set fee factors: [0]
   4. Initialise position: [41450]
   5. Calc fees: [0]
   6. Update position: [25000]
   7. Calculate token amounts: [875560]
5. Update fees: [20000]
6. Update reserves: [40000]
7. Transfer tokens: [803780]
8. Emit event: [1000]

Total: [2028790]

# Swap

## Case 1: (SPZN): Swap with normal liquidity position, zero liquidity, no limit crossed

1. Update swap_id: [10000]
2. Read state: [60000]
3. Run checks: [1000]
4. Update Strategy: [1000][T]
5. Fetch fee rate: [0]
6. Init swap state: [25000]
7. Swap Iterator: [14098030][T]
   1. Checks + Init state: [0]
   2. Tree next limit: [111320]
   3. Calculate target price: [425280]
   4. Compute Swap Amounts: [0][T]
      1. Calculate amounts: [0]
      2. Calculate next sqrt price: [0]
      3. Update amounts: [0]
      4. Calc fee: [0]
   5. Calc amts + fees: [0]
   6. Update market state: [8913060]
8. Calc swap amts: [0]
9. Update fee: [20000]
10. Update market state: [25000]
11. Update reserves: [40000]
12. Fill full limits: [10127810] [T]
13. Fill partial limits: [55010] [T]
   1. Read State: [55010]
14. Transfer tokens: [721700]
15. Strategy cleanup: [0]
16. Emit event: [1000]

Total: [25185550]

## Case 2: (SPHN): Swap with normal liquidity position, high liquidity, no limit crossed

1. Update swap_id: [10000]
2. Read state: [60000]
3. Run checks: [1000]
4. Update Strategy: [1000][T]
5. Fetch fee rate: [0]
6. Init swap state: [25000]
7. Swap Iterator: [14098030][T]
   1. Checks + Init state: [0]
   2. Tree next limit: [111320]
   3. Calculate target price: [425280]
   4. Compute Swap Amounts: [0][T]
      1. Calculate amounts: [0]
      2. Calculate next sqrt price: [0]
      3. Update amounts: [0]
      4. Calc fee: [0]
   5. Calc amts + fees: [0]
   6. Update market state: [8913060]
8. Calc swap amts: [0]
9. Update fee: [20000]
10. Update market state: [25000]
11. Update reserves: [40000]
12. Fill full limits: [10127810] [T]
13. Fill partial limits: [0] [T]
14. Transfer tokens: [721700]
15. Strategy cleanup: [0]
16. Emit event: [1000]

Total: [25130540]

## Case 3: (SPZ1): Swap with normal liquidity position, zero liquidity, one limit crossed

1. Update swap_id: [10000]
2. Read state: [60000]
3. Run checks: [1000]
4. Update Strategy: [1000][T]
5. Fetch fee rate: [0]
6. Init swap state: [25000]
7. Swap Iterator: [19386160][T]
   1. 1st Iteration: [586600][T]
      1. Checks + Init state: [0]
      2. Tree next limit: [111320]
      3. Calculate target price: [425280]
      4. Compute Swap Amounts: [0][T]
         1. Calculate amounts: [0]
         2. Calculate next sqrt price: [0]
         3. Update amounts: [0]
         4. Calc fee: [0]
      5. Calc amts + fees: [0]
      6. Append filled limit: [0]
      7. Update limit info: [50000]
      8. Update mkt state: [0]
   2. 2nd Iteration: [9502820][T]
      1. Checks + Init state: [0]
      2. Tree next limit: [164480]
      3. Calculate target price: [425280]
      4. Compute Swap Amounts: [0][T]
         1. Calculate amounts: [0]
         2. Calculate next sqrt price: [0]
         3. Update amounts: [0]
         4. Calc fee: [0]
      5. Calc amts + fees: [0]
      6. Update mkt state: [8913060]
8. Calc swap amts: [0]
9. Update fee: [20000]
10. Update market state: [25000]
11. Update reserves: [40000]
12. Fill full limits: [10127810] [T]
13. Fill partial limits: [0] [T]
14. Transfer tokens: [721700]
15. Strategy cleanup: [0]
16. Emit event: [1000]

Total: [30418670]

## Case 4: (SPH1): Swap with normal liquidity position, high liquidity, one limit crossed

1. Update swap_id: [10000]
2. Read state: [60000]
3. Run checks: [1000]
4. Update Strategy: [1000][T]
5. Fetch fee rate: [0]
6. Init swap state: [25000]
7. Swap Iterator: [11918420][T]
   1. 1st Iteration: [1065040][T]
      1. Checks + Init state: [0]
      2. Tree next limit: [589760]
      3. Calculate target price: [425280]
      4. Compute Swap Amounts: [0][T]
         1. Calculate amounts: [0]
         2. Calculate next sqrt price: [0]
         3. Update amounts: [0]
         4. Calc fee: [0]
      5. Calc amts + fees: [0]
      6. Append filled limit: [0]
      7. Update limit info: [50000]
      8. Update mkt state: [0]
   2. 2nd Iteration: [1556640][T]
      1. Checks + Init state: [0]
      2. Tree next limit: [1131360]
      3. Calculate target price: [425280]
      4. Compute Swap Amounts: [0][T]
         1. Calculate amounts: [0]
         2. Calculate next sqrt price: [0]
         3. Update amounts: [0]
         4. Calc fee: [0]
      5. Calc amts + fees: [0]
8. Calc swap amts: [0]
9. Update fee: [20000]
10. Update market state: [25000]
11. Update reserves: [40000]
12. Fill full limits: [10127810] [T]
13. Fill partial limits: [0] [T]
14. Transfer tokens: [721700]
15. Strategy cleanup: [0]
16. Emit event: [1000]

Total: [22950930]

## Case 5: (SPH4): Swap with normal liquidity position, high liquidity, four limits crossed

1. Update swap_id: [10000]
2. Read state: [60000]
3. Run checks: [1000]
4. Update Strategy: [1000][T]
5. Fetch fee rate: [0]
6. Init swap state: [25000]
7. Swap Iterator: [28768240][T]
   1. 1st Iteration: [533440][T]
      1. Checks + Init state: [0]
      2. Tree next limit: [58160]
      3. Calculate target price: [425280]
      4. Compute Swap Amounts: [0][T]
         1. Calculate amounts: [0]
         2. Calculate next sqrt price: [0]
         3. Update amounts: [0]
         4. Calc fee: [0]
      5. Calc amts + fees: [0]
      6. Append filled limit: [0]
      7. Update limit info: [50000]
      8. Update mkt state: [0]
   2. 2nd Iteration: [799240][T]
      1. Checks + Init state: [0]
      2. Tree next limit: [323960]
      3. Calculate target price: [425280]
      4. Compute Swap Amounts: [0][T]
         1. Calculate amounts: [0]
         2. Calculate next sqrt price: [0]
         3. Update amounts: [0]
         4. Calc fee: [0]
      5. Calc amts + fees: [0]
      6. Append filled limit: [0]
      7. Update limit info: [50000]
      8. Update mkt state: [0]
   3. 3rd Iteration: [1075040][T]
      1. Checks + Init state: [0]
      2. Tree next limit: [599760]
      3. Calculate target price: [425280]
      4. Compute Swap Amounts: [0][T]
         1. Calculate amounts: [0]
         2. Calculate next sqrt price: [0]
         3. Update amounts: [0]
         4. Calc fee: [0]
      5. Calc amts + fees: [0]
      6. Append filled limit: [0]
      7. Update limit info: [50000]
      8. Update mkt state: [0]
   4. 4th Iteration: [1350840][T]
      1. Checks + Init state: [0]
      2. Tree next limit: [875560]
      3. Calculate target price: [425280]
      4. Compute Swap Amounts: [0][T]
         1. Calculate amounts: [0]
         2. Calculate next sqrt price: [0]
         3. Update amounts: [0]
         4. Calc fee: [0]
      5. Calc amts + fees: [0]
      6. Append filled limit: [0]
      7. Update limit info: [50000]
      8. Update mkt state: [0]
   5. 5th Iteration: [1237680][T]
      1. Checks + Init state: [0]
      2. Tree next limit: [1237680]
8. Calc swap amts: [0]
9. Update fee: [20000]
10. Update market state: [25000]
11. Update reserves: [40000]
12. Fill full limits: [50859090] [T]
   1. 1st Iteration: [55010]
   2. 2nd Iteration: [55010]
   3. 3nd Iteration: [55010]
   4. 4nd Iteration: [55010]
13. Fill partial limits: [0] [T]
14. Transfer tokens: [721700]
15. Strategy cleanup: [0]
16. Emit event: [1000]

Total: [80001880]

## Case 6: (SPZ4): Swap with normal liquidity position, zero liquidity, four limits crossed

1. Update swap_id: [10000]
2. Read state: [60000]
3. Run checks: [1000]
4. Update Strategy: [1000][T]
5. Fetch fee rate: [0]
6. Init swap state: [25000]
7. Swap Iterator: [33738860][T]
   1. 1st Iteration: [533440][T]
      1. Checks + Init state: [0]
      2. Tree next limit: [58160]
      3. Calculate target price: [425280]
      4. Compute Swap Amounts: [0][T]
         1. Calculate amounts: [0]
         2. Calculate next sqrt price: [0]
         3. Update amounts: [0]
         4. Calc fee: [0]
      5. Calc amts + fees: [0]
      6. Append filled limit: [0]
      7. Update limit info: [50000]
      8. Update mkt state: [0]
   2. 2nd Iteration: [799240][T]
      1. Checks + Init state: [0]
      2. Tree next limit: [323960]
      3. Calculate target price: [425280]
      4. Compute Swap Amounts: [0][T]
         1. Calculate amounts: [0]
         2. Calculate next sqrt price: [0]
         3. Update amounts: [0]
         4. Calc fee: [0]
      5. Calc amts + fees: [0]
      6. Append filled limit: [0]
      7. Update limit info: [50000]
      8. Update mkt state: [0]
   3. 3rd Iteration: [852400][T]
      1. Checks + Init state: [0]
      2. Tree next limit: [377120]
      3. Calculate target price: [425280]
      4. Compute Swap Amounts: [0][T]
         1. Calculate amounts: [0]
         2. Calculate next sqrt price: [0]
         3. Update amounts: [0]
         4. Calc fee: [0]
      5. Calc amts + fees: [0]
      6. Append filled limit: [0]
      7. Update limit info: [50000]
      8. Update mkt state: [0]
   4. 4th Iteration: [1075040][T]
      1. Checks + Init state: [0]
      2. Tree next limit: [599760]
      3. Calculate target price: [425280]
      4. Compute Swap Amounts: [0][T]
         1. Calculate amounts: [0]
         2. Calculate next sqrt price: [0]
         3. Update amounts: [0]
         4. Calc fee: [0]
      5. Calc amts + fees: [0]
      6. Append filled limit: [0]
      7. Update limit info: [50000]
      8. Update mkt state: [0]
   5. 5th Iteration: [1350840][T]
      1. Checks + Init state: [0]
      2. Tree next limit: [875560]
      3. Calculate target price: [425280]
      4. Compute Swap Amounts: [0][T]
         1. Calculate amounts: [0]
         2. Calculate next sqrt price: [0]
         3. Update amounts: [0]
         4. Calc fee: [0]
      5. Calc amts + fees: [0]
      6. Append filled limit: [0]
      7. Update limit info: [50000]
      8. Update mkt state: [0]
   6. 6th Iteration: [1237680][T]
      1. Checks + Init state: [0]
      2. Tree next limit: [1237680]
8. Calc swap amts: [0]
9. Update fee: [20000]
10. Update market state: [25000]
11. Update reserves: [40000]
12. Fill full limits: [50859090] [T]
   1. 1st Iteration: [55010]
   2. 2nd Iteration: [55010]
   3. 3nd Iteration: [55010]
   4. 4nd Iteration: [55010]
13. Fill partial limits: [0] [T]
14. Transfer tokens: [721700]
15. Strategy cleanup: [0]
16. Emit event: [1000]

Total: [85502650]

## Case 7: (SPZ9): Swap with normal liquidity position, zero liquidity, nine limits crossed

1. Update swap_id: [10000]
2. Read state: [60000]
3. Run checks: [1000]
4. Update Strategy: [1000][T]
5. Fetch fee rate: [0]
6. Init swap state: [25000]
7. Swap Iterator: [62900670][T]
   1. 1st Iteration: [533440][T]
      1. Checks + Init state: [0]
      2. Tree next limit: [58160]
      3. Calculate target price: [425280]
      4. Compute Swap Amounts: [0][T]
         1. Calculate amounts: [0]
         2. Calculate next sqrt price: [0]
         3. Update amounts: [0]
         4. Calc fee: [0]
      5. Calc amts + fees: [0]
      6. Append filled limit: [0]
      7. Update limit info: [50000]
      8. Update mkt state: [0]
   2. 2nd Iteration: [852400][T]
      1. Checks + Init state: [0]
      2. Tree next limit: [377120]
      3. Calculate target price: [425280]
      4. Compute Swap Amounts: [0][T]
         1. Calculate amounts: [0]
         2. Calculate next sqrt price: [0]
         3. Update amounts: [0]
         4. Calc fee: [0]
      5. Calc amts + fees: [0]
      6. Append filled limit: [0]
      7. Update limit info: [50000]
      8. Update mkt state: [0]
   3. 3rd Iteration: [1065040][T]
      1. Checks + Init state: [0]
      2. Tree next limit: [589760]
      3. Calculate target price: [425280]
      4. Compute Swap Amounts: [0][T]
         1. Calculate amounts: [0]
         2. Calculate next sqrt price: [0]
         3. Update amounts: [0]
         4. Calc fee: [0]
      5. Calc amts + fees: [0]
      6. Append filled limit: [0]
      7. Update limit info: [50000]
      8. Update mkt state: [0]
   4. 4th Iteration: [1011880][T]
      1. Checks + Init state: [0]
      2. Tree next limit: [536600]
      3. Calculate target price: [425280]
      4. Compute Swap Amounts: [0][T]
         1. Calculate amounts: [0]
         2. Calculate next sqrt price: [0]
         3. Update amounts: [0]
         4. Calc fee: [0]
      5. Calc amts + fees: [0]
      6. Append filled limit: [0]
      7. Update limit info: [50000]
      8. Update mkt state: [0]
   5. 5th Iteration: [1224520][T]
      1. Checks + Init state: [0]
      2. Tree next limit: [749240]
      3. Calculate target price: [425280]
      4. Compute Swap Amounts: [0][T]
         1. Calculate amounts: [0]
         2. Calculate next sqrt price: [0]
         3. Update amounts: [0]
         4. Calc fee: [0]
      5. Calc amts + fees: [0]
      6. Append filled limit: [0]
      7. Update limit info: [50000]
      8. Update mkt state: [0]
   6. 6th Iteration: [1128200][T]
      1. Checks + Init state: [0]
      2. Tree next limit: [652920]
      3. Calculate target price: [425280]
      4. Compute Swap Amounts: [0][T]
         1. Calculate amounts: [0]
         2. Calculate next sqrt price: [0]
         3. Update amounts: [0]
         4. Calc fee: [0]
      5. Calc amts + fees: [0]
      6. Append filled limit: [0]
      7. Update limit info: [50000]
      8. Update mkt state: [0]
   7. 7th Iteration: [1011880][T]
      1. Checks + Init state: [0]
      2. Tree next limit: [536600]
      3. Calculate target price: [425280]
      4. Compute Swap Amounts: [0][T]
         1. Calculate amounts: [0]
         2. Calculate next sqrt price: [0]
         3. Update amounts: [0]
         4. Calc fee: [0]
      5. Calc amts + fees: [0]
      6. Append filled limit: [0]
      7. Update limit info: [50000]
      8. Update mkt state: [0]
   8. 8th Iteration: [1287680][T]
      1. Checks + Init state: [0]
      2. Tree next limit: [812400]
      3. Calculate target price: [425280]
      4. Compute Swap Amounts: [0][T]
         1. Calculate amounts: [0]
         2. Calculate next sqrt price: [0]
         3. Update amounts: [0]
         4. Calc fee: [0]
      5. Calc amts + fees: [0]
      6. Append filled limit: [0]
      7. Update limit info: [50000]
      8. Update mkt state: [0]
   9. 9th Iteration: [1065040][T]
      1. Checks + Init state: [0]
      2. Tree next limit: [589760]
      3. Calculate target price: [425280]
      4. Compute Swap Amounts: [0][T]
         1. Calculate amounts: [0]
         2. Calculate next sqrt price: [0]
         3. Update amounts: [0]
         4. Calc fee: [0]
      5. Calc amts + fees: [0]
      6. Append filled limit: [0]
      7. Update limit info: [50000]
      8. Update mkt state: [0]
   10. 10th Iteration: [1350840][T]
      1. Checks + Init state: [0]
      2. Tree next limit: [875560]
      3. Calculate target price: [425280]
      4. Compute Swap Amounts: [0][T]
         1. Calculate amounts: [0]
         2. Calculate next sqrt price: [0]
         3. Update amounts: [0]
         4. Calc fee: [0]
      5. Calc amts + fees: [0]
      6. Append filled limit: [0]
      7. Update limit info: [50000]
      8. Update mkt state: [0]
   11. 11th Iteration: [1237680][T]
      1. Checks + Init state: [0]
      2. Tree next limit: [1237680]
8. Calc swap amts: [0]
9. Update fee: [20000]
10. Update market state: [25000]
11. Update reserves: [40000]
12. Fill full limits: [101773190] [T]
   1. 1st Iteration: [55010]
   2. 2nd Iteration: [55010]
   3. 3nd Iteration: [55010]
   4. 4nd Iteration: [55010]
   5. 5th Iteration: [55010]
   6. 6th Iteration: [55010]
   7. 7th Iteration: [55010]
   8. 8th Iteration: [55010]
   9. 9th Iteration: [55010]
13. Fill partial limits: [0] [T]
14. Transfer tokens: [721700]
15. Strategy cleanup: [0]
16. Emit event: [1000]

Total: [165578560]

## Case 8: (SPH9): Swap with normal liquidity position, high liquidity, nine limits crossed

1. Update swap_id: [10000]
2. Read state: [60000]
3. Run checks: [1000]
4. Update Strategy: [1000][T]
5. Fetch fee rate: [0]
6. Init swap state: [25000]
7. Swap Iterator: [57399900][T]
   1. 1st Iteration: [533440][T]
      1. Checks + Init state: [0]
      2. Tree next limit: [58160]
      3. Calculate target price: [425280]
      4. Compute Swap Amounts: [0][T]
         1. Calculate amounts: [0]
         2. Calculate next sqrt price: [0]
         3. Update amounts: [0]
         4. Calc fee: [0]
      5. Calc amts + fees: [0]
      6. Append filled limit: [0]
      7. Update limit info: [50000]
      8. Update mkt state: [0]
   2. 2nd Iteration: [1065040][T]
      1. Checks + Init state: [0]
      2. Tree next limit: [589760]
      3. Calculate target price: [425280]
      4. Compute Swap Amounts: [0][T]
         1. Calculate amounts: [0]
         2. Calculate next sqrt price: [0]
         3. Update amounts: [0]
         4. Calc fee: [0]
      5. Calc amts + fees: [0]
      6. Append filled limit: [0]
      7. Update limit info: [50000]
      8. Update mkt state: [0]
   3. 3rd Iteration: [1011880][T]
      1. Checks + Init state: [0]
      2. Tree next limit: [536600]
      3. Calculate target price: [425280]
      4. Compute Swap Amounts: [0][T]
         1. Calculate amounts: [0]
         2. Calculate next sqrt price: [0]
         3. Update amounts: [0]
         4. Calc fee: [0]
      5. Calc amts + fees: [0]
      6. Append filled limit: [0]
      7. Update limit info: [50000]
      8. Update mkt state: [0]
   4. 4th Iteration: [1224520][T]
      1. Checks + Init state: [0]
      2. Tree next limit: [749240]
      3. Calculate target price: [425280]
      4. Compute Swap Amounts: [0][T]
         1. Calculate amounts: [0]
         2. Calculate next sqrt price: [0]
         3. Update amounts: [0]
         4. Calc fee: [0]
      5. Calc amts + fees: [0]
      6. Append filled limit: [0]
      7. Update limit info: [50000]
      8. Update mkt state: [0]
   5. 5th Iteration: [1128200][T]
      1. Checks + Init state: [0]
      2. Tree next limit: [652920]
      3. Calculate target price: [425280]
      4. Compute Swap Amounts: [0][T]
         1. Calculate amounts: [0]
         2. Calculate next sqrt price: [0]
         3. Update amounts: [0]
         4. Calc fee: [0]
      5. Calc amts + fees: [0]
      6. Append filled limit: [0]
      7. Update limit info: [50000]
      8. Update mkt state: [0]
   6. 6th Iteration: [1011880][T]
      1. Checks + Init state: [0]
      2. Tree next limit: [536600]
      3. Calculate target price: [425280]
      4. Compute Swap Amounts: [0][T]
         1. Calculate amounts: [0]
         2. Calculate next sqrt price: [0]
         3. Update amounts: [0]
         4. Calc fee: [0]
      5. Calc amts + fees: [0]
      6. Append filled limit: [0]
      7. Update limit info: [50000]
      8. Update mkt state: [0]
   7. 7th Iteration: [1287680][T]
      1. Checks + Init state: [0]
      2. Tree next limit: [812400]
      3. Calculate target price: [425280]
      4. Compute Swap Amounts: [0][T]
         1. Calculate amounts: [0]
         2. Calculate next sqrt price: [0]
         3. Update amounts: [0]
         4. Calc fee: [0]
      5. Calc amts + fees: [0]
      6. Append filled limit: [0]
      7. Update limit info: [50000]
      8. Update mkt state: [0]
   8. 8th Iteration: [1065040][T]
      1. Checks + Init state: [0]
      2. Tree next limit: [589760]
      3. Calculate target price: [425280]
      4. Compute Swap Amounts: [0][T]
         1. Calculate amounts: [0]
         2. Calculate next sqrt price: [0]
         3. Update amounts: [0]
         4. Calc fee: [0]
      5. Calc amts + fees: [0]
      6. Append filled limit: [0]
      7. Update limit info: [50000]
      8. Update mkt state: [0]
   9. 9th Iteration: [1350840][T]
      1. Checks + Init state: [0]
      2. Tree next limit: [875560]
      3. Calculate target price: [425280]
      4. Compute Swap Amounts: [0][T]
         1. Calculate amounts: [0]
         2. Calculate next sqrt price: [0]
         3. Update amounts: [0]
         4. Calc fee: [0]
      5. Calc amts + fees: [0]
      6. Append filled limit: [0]
      7. Update limit info: [50000]
      8. Update mkt state: [0]
   10. 10th Iteration: [1237680][T]
      1. Checks + Init state: [0]
      2. Tree next limit: [1237680]
8. Calc swap amts: [0]
9. Update fee: [20000]
10. Update market state: [25000]
11. Update reserves: [40000]
12. Fill full limits: [101773190] [T]
   1. 1st Iteration: [55010]
   2. 2nd Iteration: [55010]
   3. 3nd Iteration: [55010]
   4. 4nd Iteration: [55010]
   5. 5th Iteration: [55010]
   6. 6th Iteration: [55010]
   7. 7th Iteration: [55010]
   8. 8th Iteration: [55010]
   9. 9th Iteration: [55010]
13. Fill partial limits: [0] [T]
14. Transfer tokens: [721700]
15. Strategy cleanup: [0]
16. Emit event: [1000]

Total: [160077790]

## Case 9: (SLLFF): Swap with limit order, limit fully filled

1. Update swap_id: [10000]
2. Read state: [60000]
3. Run checks: [1000]
4. Update Strategy: [1000][T]
5. Fetch fee rate: [0]
6. Init swap state: [25000]
7. Swap Iterator: [14044870][T]
   1. Checks + Init state: [0]
   2. Tree next limit: [58160]
   3. Calculate target price: [425280]
   4. Compute Swap Amounts: [0][T]
      1. Calculate amounts: [0]
      2. Calculate next sqrt price: [0]
      3. Update amounts: [0]
      4. Calc fee: [0]
   5. Calc amts + fees: [0]
   6. Update mkt state: [8913060]
8. Calc swap amts: [0]
9. Update fee: [20000]
10. Update market state: [25000]
11. Update reserves: [40000]
12. Fill full limits: [10127810] [T]
13. Fill partial limits: [0] [T]
14. Transfer tokens: [721700]
15. Strategy cleanup: [0]
16. Emit event: [1000]

Total: [25077380]

## Case 10: (SLLPF): Swap with limit order, limit partially filled

1. Update swap_id: [10000]
2. Read state: [60000]
3. Run checks: [1000]
4. Update Strategy: [1000][T]
5. Fetch fee rate: [0]
6. Init swap state: [25000]
7. Swap Iterator: [19492480][T]
   1. 1st Iteration: [533440][T]
      1. Checks + Init state: [0]
      2. Tree next limit: [58160]
      3. Calculate target price: [425280]
      4. Compute Swap Amounts: [0][T]
         1. Calculate amounts: [0]
         2. Calculate next sqrt price: [0]
         3. Update amounts: [0]
         4. Calc fee: [0]
      5. Calc amts + fees: [0]
      6. Append filled limit: [0]
      7. Update limit info: [50000]
      8. Update mkt state: [0]
   2. 2nd Iteration: [9662300][T]
      1. Checks + Init state: [0]
      2. Tree next limit: [323960]
      3. Calculate target price: [425280]
      4. Compute Swap Amounts: [0][T]
         1. Calculate amounts: [0]
         2. Calculate next sqrt price: [0]
         3. Update amounts: [0]
         4. Calc fee: [0]
      5. Calc amts + fees: [0]
      6. Update market state: [8913060]
8. Calc swap amts: [0]
9. Update fee: [20000]
10. Update market state: [25000]
11. Update reserves: [40000]
12. Fill full limits: [10127810] [T]
13. Fill partial limits: [75010] [T]
   1. Read State: [55010]
   2. Update Fill: [20000]
14. Transfer tokens: [721700]
15. Strategy cleanup: [0]
16. Emit event: [1000]

Total: [30600000]

## Case 11 (SSNP): Swap with strategy enabled, no position updates

1. Update swap_id: [10000]
2. Read state: [60000]
3. Run checks: [1000]
4. Update Strategy: [22478780][T]
5. Fetch fee rate: [0]
6. Init swap state: [25000]
7. Swap Iterator: [14224350][T]
   1. Checks + Init state: [0]
   2. Tree next limit: [662920]
   3. Calculate target price: [425280]
   4. Compute Swap Amounts: [0][T]
      1. Calculate amounts: [0]
      2. Calculate next sqrt price: [0]
      3. Update amounts: [0]
      4. Calc fee: [0]
   5. Calc amts + fees: [0]
   6. Update market state: [8487780]
8. Calc swap amts: [0]
9. Update fee: [20000]
10. Update market state: [25000]
11. Update reserves: [40000]
12. Fill full limits: [10127810] [T]
13. Fill partial limits: [55010] [T]
   1. Read State: [55010]
14. Transfer tokens: [721700]
15. Strategy cleanup: [61000]
16. Emit event: [1000]

Total: [47850650]

## Case 12 (SSOP): Swap with strategy enabled, one position updates

1. Update swap_id: [10000]
2. Read state: [60000]
3. Run checks: [1000]
4. Update Strategy: [23329340][T]
5. Fetch fee rate: [0]
6. Init swap state: [25000]
7. Swap Iterator: [14224350][T]
   1. Checks + Init state: [0]
   2. Tree next limit: [662920]
   3. Calculate target price: [425280]
   4. Compute Swap Amounts: [0][T]
      1. Calculate amounts: [0]
      2. Calculate next sqrt price: [0]
      3. Update amounts: [0]
      4. Calc fee: [0]
   5. Calc amts + fees: [0]
   6. Update market state: [8487780]
8. Calc swap amts: [0]
9. Update fee: [20000]
10. Update market state: [25000]
11. Update reserves: [40000]
12. Fill full limits: [10127810] [T]
13. Fill partial limits: [55010] [T]
   1. Read State: [55010]
14. Transfer tokens: [721700]
15. Strategy cleanup: [61000]
16. Emit event: [1000]

Total: [48701210]

## Case 13 (SSBP): Swap with strategy enabled, both position updates

1. Update swap_id: [10000]
2. Read state: [60000]
3. Run checks: [1000]
4. Update Strategy: [50765720][T]
5. Fetch fee rate: [0]
6. Init swap state: [25000]
7. Swap Iterator: [14204350][T]
   1. Checks + Init state: [0]
   2. Tree next limit: [642920]
   3. Calculate target price: [425280]
   4. Compute Swap Amounts: [0][T]
      1. Calculate amounts: [0]
      2. Calculate next sqrt price: [0]
      3. Update amounts: [0]
      4. Calc fee: [0]
   5. Calc amts + fees: [0]
   6. Update market state: [8487780]
8. Calc swap amts: [0]
9. Update fee: [20000]
10. Update market state: [25000]
11. Update reserves: [40000]
12. Fill full limits: [10127810] [T]
13. Fill partial limits: [0] [T]
14. Transfer tokens: [710700]
15. Strategy cleanup: [61000]
16. Emit event: [1000]

Total: [76051580]
