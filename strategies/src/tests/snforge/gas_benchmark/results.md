# Swap

## Case 1 (SSNP): Swap with strategy enabled, no position updates

1. Update swap_id: [10000]
2. Read state: [60000]
3. Run checks: [1000]
4. Update Strategy: [1000][T]
5. Fetch fee rate: [0]
6. Init swap state: [25000]
7. Swap Iterator: [14182900][T]
   1. Checks + Init state: [0]
   2. Tree next limit: [528440]
   3. Calculate target price: [425280]
   4. Compute Swap Amounts: [0][T]
      1. Calculate amounts: [0]
      2. Calculate next sqrt price: [0]
      3. Update amounts: [0]
      4. Calc fee: [0]
   5. Calc amts + fees: [0]
   6. Update market state: [8487780]
8. Calc swap amts: [0]
9. Update fee: [20000]
10. Update market state: [25000]
11. Update reserves: [40000]
12. Fill full limits: [10366430] [T]
13. Fill partial limits: [55010] [T]
   1. Read State: [55010]
14. Transfer tokens: [721700]
15. Strategy cleanup: [0]
16. Emit event: [1000]

Total: [25509040]

## Case 2 (SSOP): Swap with strategy enabled, one position updates

1. Update swap_id: [10000]
2. Read state: [60000]
3. Run checks: [1000]
4. Update Strategy: [1000][T]
5. Fetch fee rate: [0]
6. Init swap state: [25000]
7. Swap Iterator: [14182900][T]
   1. Checks + Init state: [0]
   2. Tree next limit: [528440]
   3. Calculate target price: [425280]
   4. Compute Swap Amounts: [0][T]
      1. Calculate amounts: [0]
      2. Calculate next sqrt price: [0]
      3. Update amounts: [0]
      4. Calc fee: [0]
   5. Calc amts + fees: [0]
   6. Update market state: [8487780]
8. Calc swap amts: [0]
9. Update fee: [20000]
10. Update market state: [25000]
11. Update reserves: [40000]
12. Fill full limits: [10366430] [T]
13. Fill partial limits: [55010] [T]
   1. Read State: [55010]
14. Transfer tokens: [721700]
15. Strategy cleanup: [0]
16. Emit event: [1000]

Total: [25509040]

## Case 3 (SSBP): Swap with strategy enabled, both position updates

1. Update swap_id: [10000]
2. Read state: [60000]
3. Run checks: [1000]
4. Update Strategy: [1000][T]
5. Fetch fee rate: [0]
6. Init swap state: [25000]
7. Swap Iterator: [14119740][T]
   1. Checks + Init state: [0]
   2. Tree next limit: [465280]
   3. Calculate target price: [425280]
   4. Compute Swap Amounts: [0][T]
      1. Calculate amounts: [0]
      2. Calculate next sqrt price: [0]
      3. Update amounts: [0]
      4. Calc fee: [0]
   5. Calc amts + fees: [0]
   6. Update market state: [8487780]
8. Calc swap amts: [0]
9. Update fee: [20000]
10. Update market state: [25000]
11. Update reserves: [40000]
12. Fill full limits: [10366430] [T]
13. Fill partial limits: [0] [T]
14. Transfer tokens: [721700]
15. Strategy cleanup: [0]
16. Emit event: [1000]

Total: [25379870]
