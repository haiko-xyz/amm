# Swap

## Case 1 (SPAFL1): Swap with threshold price and amount specified, fully filled limit and one swap iteration 

1. Update swap_id: [10000]
2. Read state: [60000]
3. Threshold check: [0]
4. Input checks: [1000]
5. Fetch fee rate and checks: [0]
6. Swap Iterator: [14333820][T]
   1. Create Snapshot: [0]
   2. Get next limit from tree: [701080]
   3. Min operation: [0]
   4. Finding threshold sqrt price for current iteration: [425280]
   5. Compute swap amounts: [0]
   6. Calculating protocol fee: [0]
   7. calculating sqrt price from limit: [8487780]
7. Update and check swap amounts: [0]
8. Calculate and update fee balance: [20000]
9. Update fully filled limit: [10366430]
10. Transfer tokens: [710700]
11. Emit event: [1000]

Total: [25502950]

## Case 2 (SPAPL2): Swap with threshold price and amount specified, partially filled limit and two swap iteration 

1. Update swap_id: [10000]
2. Read state: [60000]
3. Threshold check: [0]
4. Input checks: [1000]
5. Fetch fee rate and checks: [0]
6. Swap Iterator First Iteration: [1070040][T]
   1. Create Snapshot: [0]
   2. Get next limit from tree: [594760]
   3. Min operation: [0]
   4. Finding threshold sqrt price for current iteration: [425280]
   5. Compute swap amounts: [0]
   6. Calculating protocol fee: [0]
   7. Update fill limits array: [0]
   8. Update fee factors and commit to limit_info: [50000]
   9. Add liquidity delta: [0]
7. Swap Iterator Second Iteration: [10059420][T]
   1. Create Snapshot: [0]
   2. Get next limit from tree: [1146360]
   3. Min operation: [0]
   4. Finding threshold sqrt price for current iteration: [425280]
   5. Compute swap amounts: [0]
   6. Calculating protocol fee: [0]
   7. Calculating sqrt price from limit: [8487780]
7. Update and check swap amounts: [0]
8. Calculate and update fee balance: [20000]
9. Fill partial limits: [55010]
10. Transfer tokens: [710700]
11. Emit event: [1000]

Total: [11987170]
